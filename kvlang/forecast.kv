## WeatherFlow PiConsole: Raspberry Pi Python console for WeatherFlow Tempest
## and Smart Home Weather stations.
## Copyright (C) 2018-2025 Peter Davis

## This program is free software: you can redistribute it and/or modify it under
## the terms of the GNU General Public License as published by the Free Software
## Foundation, either version 3 of the License, or (at your option) any later
## version.

## This program is distributed in the hope that it will be useful, but WITHOUT
## ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
## FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
## details.

## You should have received a copy of the GNU General Public License along with
## this program. If not, see <http://www.gnu.org/licenses/>.

## =============================================================================
## WEATHERFLOW FORECAST PANEL AND BUTTON
## =============================================================================
<ForecastPanel>:

    ## Panel background and title
    PanelBackground:
        _panelTitle: 'Forecast'

    ## Forecast detail button
    Button:
        on_press: self.parent.forecast_detail_panel.open()
        background_color: (0,0,0,0)

    ## Forecast Conditions
    TitleField:
        text: 'Conditions'
        pos_hint: {'x': 18/262, 'y': 166/202}
        size_hint_x: 77/262
    Image:
        source: 'icons/weather/' + self.parent.forecast_icon + app.scaleSuffix
        pos_hint: {'x': 18/262, 'y': 83/202}
        size_hint: (77/262, 80/202)
        fit_mode: 'contain'
    SmallMultilineField:
        text: app.CurrentConditions.Met['current_hour']['conditions']
        pos_hint: {'x': 110/262, 'y': 80/202}
        size_hint: (132/262, 62/202)
        halign: 'left'
        line_height: 1.2

    ## Forecast status
    BoldMultilineField:
        text: app.CurrentConditions.Met['current_hour']['status']
        pos_hint: {'x': 0/262, 'y': 97/202}
        size_hint: (262/262, 35/202)

    ## Forecast windspeed
    TitleField:
        text: 'Wind Speed'
        pos_hint: {'x': 132/262, 'y': 166/202}
        size_hint_x: 110/262
    MediumField:
        text: app.CurrentConditions.Met['current_hour']['wind_speed'][0] + ' ' + app.CurrentConditions.Met['current_hour']['wind_speed'][1] + ' ' + app.CurrentConditions.Met['current_hour']['wind_dir'][0]
        pos_hint: {'x': 132/262, 'y': 145/202}
        size_hint_x: (110/262)

    ## Forecast temperature
    TitleField:
        text: 'Temperature'
        pos_hint: {'x': 5/262, 'y': 65/202}
        size_hint_x: (125/262)
    MediumField:
        text: app.CurrentConditions.Met['current_hour']['temperature'][0] + app.CurrentConditions.Met['current_hour']['temperature'][1]
        pos_hint: {'x': 5/262, 'y': 43/202}
        size_hint_x: (125/262)
    SmallField:
        pos_hint: {'x': 5/262, 'y': 25/202}
        size_hint_x: (125/262)
        text: '[color=00a4b4ff][font=fonts/Inter-Bold.ttf]L: [/font]' + app.CurrentConditions.Met['current_day']['low_temperature'][0]  + app.CurrentConditions.Met['current_day']['low_temperature'][1]  + '[/color]' + '  ' + '[color=f05e40ff][font=fonts/Inter-Bold.ttf]H: [/font]' + app.CurrentConditions.Met['current_day']['high_temperature'][0] + app.CurrentConditions.Met['current_day']['high_temperature'][1] + '[/color]'

    ## Forecast rain/snowfall
    TitleField:
        text: app.CurrentConditions.Met['current_hour']['precip_type']
        pos_hint: {'x': 152/262, 'y': 65/202}
        size_hint_x: (100/262)
    MediumField:
        text: app.CurrentConditions.Met['current_hour']['precip_percnt'][0] + app.CurrentConditions.Met['current_hour']['precip_percnt'][1]
        pos_hint: {'x': 152/262, 'y': 43/202}
        size_hint_x: (100/262)
    SmallField:
        text: '[color=ffffffff]Daily[/color]: ' + app.CurrentConditions.Met['current_day']['precip_percnt'][0] + app.CurrentConditions.Met['current_day']['precip_percnt'][1]
        pos_hint: {'x': 152/262, 'y': 25/202}
        size_hint_x: (100/262)

    ## Forecast valid time
    SmallField:
        text: 'Forecast for ' + app.CurrentConditions.Met['current_hour']['valid_time']
        pos_hint: {'x': 5/262, 'y': 2/202}
        size_hint: (252/262, 17/202)
        text_size: self.size
        halign: 'right'

<ForecastButton>:
    PanelButton:
        text: 'Forecast'
        on_release: app.CurrentConditions.switchPanel(self)

## =============================================================================
## SAGER FORECAST PANEL AND BUTTON
## =============================================================================
<SagerPanel>:

    ## Panel background and title
    PanelBackground:
        _panelTitle: 'Sager'

    ## Sager Weathercaster forecast
    MediumMultilineField:
        text: app.CurrentConditions.Sager['Forecast']
        pos_hint: {'x': 5/262, 'y': 21/202}
        size_hint: (252/262, 157/202)

    ## Forecast issue time
    SmallField:
        text: 'Forecast issued: ' + app.CurrentConditions.Sager['Issued']
        pos_hint: {'x': 5/262, 'y': 2/202}
        size_hint: (252/262, 17/202)
        text_size: self.size
        halign: 'right'

<SagerButton>:
    PanelButton:
        text: 'Sager'
        on_release: app.CurrentConditions.switchPanel(self)

## =============================================================================
## FORECAST DETAIL POPUP
## =============================================================================
<forecast_detail>:
    size_hint: (640/800, 384/480)
    canvas:
        Color:
            rgba: 0,0,0,1
        Rectangle:
            pos: self.pos
            size: self.size
    GridLayout:
        padding: dp(5)
        cols: 1
        size_hint: None, None
        pos: root.pos
        size: root.size
        TabbedPanel:
            background_color: (0, 0, 0,0)
            do_default_tab: False
            tab_pos: 'bottom_left'
            tab_height: 40*app.scaleFactor
            tab_width: 100*app.scaleFactor
            MainMenuTab:
                text: '12 Hour'
                MainMenuLayout:
                    padding: [0, 0, 0, dp(15)]
                    BoxLayout:
                        orientation: 'horizontal'
                        BoxLayout:
                            orientation: 'vertical'
                            size_hint_x: 0.16
                            SmallField:
                                size_hint_y: (1/8)
                            SmallField:
                                size_hint_y: (1/8)
                            BoldField:
                                text: "Temperature / Feels like"
                                size_hint_y: (1/8)
                                halign: 'left'
                                text_size: self.size
                            BoldField:
                                text: "Wind speed"
                                size_hint_y: (1/8)
                                halign: 'left'
                                text_size: self.size 
                            BoldField:
                                text: "Wind gust"
                                size_hint_y: (1/8) 
                                halign: 'left'
                                text_size: self.size 
                            BoldField:
                                text: "Wind Direction"
                                size_hint_y: (1/8)
                                halign: 'left'
                                text_size: self.size  
                            BoldField:
                                text: "Precipitation"
                                size_hint_y: (1/8) 
                                halign: 'left'
                                text_size: self.size
                            BoldField:
                                text: "Amount"
                                size_hint_y: (1/8) 
                                halign: 'left'
                                text_size: self.size
                        BoxLayout:
                            size_hint_x: 0.84
                            ScrollView:
                                do_scroll_x: True
                                do_scroll_y: False
                                bar_width: dp(5)
                                BoxLayout:
                                    size_hint_x: None
                                    width: self.minimum_width
                                    Forecast12HourPanel:
                                        id: hour_0
                                    Forecast12HourPanel:
                                        id: hour_1
                                    Forecast12HourPanel:
                                        id: hour_2
                                    Forecast12HourPanel:
                                        id: hour_3
                                    Forecast12HourPanel:
                                        id: hour_4
                                    Forecast12HourPanel:
                                        id: hour_5
                                    Forecast12HourPanel:
                                        id: hour_6
                                    Forecast12HourPanel:
                                        id: hour_7
                                    Forecast12HourPanel:
                                        id: hour_8
                                    Forecast12HourPanel:
                                        id: hour_9
                                    Forecast12HourPanel:
                                        id: hour_10
                                    Forecast12HourPanel:
                                        id: hour_11
            MainMenuTab:
                text: '5 Day'
                MainMenuLayout:

            MainMenuTab:
                text: 'METAR'
                MainMenuLayout:
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint: (1,.2)
                        MediumMultilineField:
                            halign: 'left'
                            valign: 'top'
                            text: app.CurrentConditions.metar_taf['metar_location_string'] + '. ' + app.CurrentConditions.metar_taf['metar_timing_string']
                            font_size: dp(16*app.scaleFactor)
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint: (1,.8)
                        SmallMultilineField:
                            halign: 'left'
                            valign: 'top'
                            ##size_hint: (0.95, None)
                            height: self.texture_size[1]
                            text_size: self.width, None
                            text: app.CurrentConditions.metar_taf['metar_observation_string']
            MainMenuTab:
                text: 'TAF'
                MainMenuLayout:
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint: (1,.2)
                        MediumMultilineField:
                            halign: 'left'
                            valign: 'top'
                            text: app.CurrentConditions.metar_taf['taf_location_string'] + '. ' + app.CurrentConditions.metar_taf['taf_timing_string']
                            font_size: dp(16*app.scaleFactor)
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint: (1,.8)
                        SmallMultilineField:
                            halign: 'left'
                            valign: 'top'
                            ##size_hint: (0.95, None)
                            height: self.texture_size[1]
                            text_size: self.width, None
                            text: app.CurrentConditions.metar_taf['taf_forecast_string']
